const flashcards = {
    imagery: [
        {
            question: "What is mental imagery?",
            answer: "Mental imagery is the cognitive process of creating or recreating experiences in the mind using all senses (visual, auditory, kinesthetic, etc.) to visualize actions, scenarios, or events without actual physical execution. It involves mentally simulating experiences as if they were actually happening."
        },
        {
            question: "What is the difference between internal and external imagery?",
            answer: "Internal imagery involves visualizing from a first-person perspective (seeing through your own eyes), experiencing the action as if you are actually performing it. External imagery involves viewing yourself from a third-person perspective (like watching a video of yourself), observing yourself performing the action from an outside viewpoint."
        },
        {
            question: "Why do athletes use imagery?",
            answer: "Athletes use imagery to improve performance, enhance motivation, build confidence, practice skills mentally, prepare for competition, manage anxiety, recover from injury, and develop mental toughness. It allows them to rehearse and perfect skills without physical practice."
        },
        {
            question: "What are the different purposes/uses of mental imagery?",
            answer: "The main purposes include: (1) Skill acquisition and refinement - practicing techniques mentally, (2) Strategy development - mentally rehearsing game plans, (3) Performance enhancement - improving execution, (4) Arousal regulation - controlling anxiety and activation levels, (5) Confidence building - visualizing success, (6) Injury rehabilitation - maintaining skills during recovery, (7) Concentration - focusing attention, and (8) Motivation - enhancing drive and commitment."
        },
        {
            question: "What are the various explanations of how imagery works?",
            answer: "Key explanations include: (1) Psychoneuromuscular theory - imagery activates the same neural pathways as physical practice, (2) Symbolic learning theory - imagery helps develop mental blueprints or cognitive maps, (3) Bioinformational theory - imagery activates stimulus and response propositions stored in memory, (4) Triple code model - imagery involves image, somatic response, and meaning, and (5) Functional equivalence - imagery and physical practice share similar neural mechanisms."
        },
        {
            question: "What are the keys to effective imagery (vividness and controllability) and why are they important?",
            answer: "Vividness refers to the clarity, detail, and realism of the mental image (using all senses). Controllability refers to the ability to manipulate and control the images in your mind. Both are important because vivid imagery creates more realistic mental practice, while controllability allows athletes to correct mistakes, practice different scenarios, and maintain positive images. Together, they make imagery more effective and transferable to actual performance."
        }
    ],
    goals: [
        {
            question: "What are the key goal setting principles?",
            answer: "Key principles include: (1) Set specific and measurable goals, (2) Set challenging but realistic goals, (3) Set both short-term and long-term goals, (4) Set performance, process, and outcome goals, (5) Write goals down and monitor progress, (6) Provide support and feedback, (7) Set goals in positive terms, (8) Consider individual differences, and (9) Set goals for practice and competition."
        },
        {
            question: "What does SMARTS stand for in goal setting?",
            answer: "SMARTS stands for: S - Specific (clear and well-defined), M - Measurable (can be tracked and assessed), A - Action-oriented (focuses on behaviors and actions), R - Realistic (attainable yet challenging), T - Timely (has a specific timeframe), S - Self-determined (set by the individual, not imposed)."
        },
        {
            question: "What are common problems in goal setting and how can they be overcome?",
            answer: "Common problems include: (1) Setting too many goals - prioritize and focus on 2-3 key goals, (2) Setting unrealistic goals - ensure goals are challenging but achievable, (3) Failing to adjust goals - regularly review and modify as needed, (4) Setting only outcome goals - include process and performance goals, (5) Not writing goals down - document and track progress, (6) Lack of support - involve coaches, teammates, or mentors, (7) Setting negative goals - frame goals positively, and (8) Not monitoring progress - regularly assess and adjust."
        },
        {
            question: "What is the difference between outcome, performance, and process goals?",
            answer: "Outcome goals focus on the end result or winning (e.g., winning a championship, beating an opponent). Performance goals focus on personal achievement relative to one's own standards (e.g., improving personal best time, increasing batting average). Process goals focus on the specific actions, techniques, or behaviors during performance (e.g., maintaining proper form, following game plan). Process goals are most controllable and should be emphasized."
        },
        {
            question: "Why does goal setting sometimes NOT work?",
            answer: "Goal setting may fail due to: (1) Setting unrealistic or unattainable goals, (2) Lack of commitment or motivation, (3) Insufficient feedback or monitoring, (4) Setting only outcome goals without process goals, (5) Poor goal specificity, (6) Lack of support from coaches or teammates, (7) Not adjusting goals when circumstances change, (8) Setting too many goals at once, (9) Focusing on negative goals, and (10) Individual differences in goal orientation or motivation."
        }
    ],
    leadership: [
        {
            question: "Define leadership and describe differences between leaders and managers in sport contexts.",
            answer: "Leadership is the process of influencing individuals or teams to achieve common goals through direction, motivation, and coordination. In sport, leaders inspire, motivate, and guide athletes toward success. Managers focus more on organizing, planning, and administrative tasks. Leaders create vision and inspire change, while managers maintain systems and ensure efficiency. In sport, effective coaches often combine both roles."
        },
        {
            question: "What are the trait, behavioral, and interactional approaches to studying leadership?",
            answer: "Trait approach suggests leaders possess inherent personality characteristics (e.g., confidence, intelligence). Behavioral approach focuses on what leaders do (e.g., democratic vs. autocratic styles, consideration vs. initiating structure). Interactional approach combines leader traits, behaviors, and situational factors, recognizing that effective leadership depends on the interaction between the leader, followers, and situation."
        },
        {
            question: "What is known regarding leadership effectiveness, including specific leader behaviors in sport and exercise?",
            answer: "Effective leaders in sport: (1) Provide clear communication and instruction, (2) Give positive feedback and reinforcement, (3) Demonstrate technical and tactical knowledge, (4) Show concern for athletes' well-being, (5) Establish clear expectations and structure, (6) Motivate and inspire, (7) Adapt leadership style to situation, (8) Build relationships and trust, (9) Handle conflict effectively, and (10) Model desired behaviors and values."
        },
        {
            question: "What are the four components of effective leadership in sport according to Weinberg and Gould?",
            answer: "The four components are: (1) Leader's qualities - personality, experience, skills, and characteristics of the leader, (2) Leadership styles - the behavioral patterns and approaches used (e.g., democratic, autocratic), (3) Situational factors - the context, environment, and circumstances (e.g., type of sport, team cohesion, time constraints), (4) Follower's qualities - characteristics, needs, and preferences of the athletes being led."
        },
        {
            question: "What is the difference between relationship-oriented leaders and task-oriented leaders?",
            answer: "Relationship-oriented leaders focus on building relationships, maintaining harmony, and meeting the social and emotional needs of team members. They emphasize communication, support, and team cohesion. Task-oriented leaders focus on achieving goals, completing tasks, and ensuring performance standards. They emphasize structure, organization, and results. Effective leaders often balance both orientations depending on the situation."
        },
        {
            question: "What are the four components of Transformational Leadership?",
            answer: "The four components are: (1) Idealized influence (charisma) - leaders serve as role models and earn respect and trust, (2) Inspirational motivation - leaders communicate a compelling vision and inspire commitment, (3) Intellectual stimulation - leaders encourage creativity, innovation, and critical thinking, (4) Individualized consideration - leaders attend to individual needs, provide support, and act as mentors."
        },
        {
            question: "What do John Wooden's principles teach us about success and factors in sport psychology?",
            answer: "John Wooden emphasized that success is about doing your best and maximizing your potential, not just winning. His principles highlight the importance of: (1) Process over outcome - focus on effort and preparation, (2) Character and values - integrity, discipline, and respect, (3) Continuous improvement - 'Make each day your masterpiece', (4) Preparation and fundamentals - mastery of basics, (5) Team unity and selflessness. This aligns with sport psychology concepts of process goals, intrinsic motivation, mental preparation, and team cohesion."
        }
    ],
    teams: [
        {
            question: "What is social loafing and in what conditions is it most likely to occur?",
            answer: "Social loafing is the tendency for individuals to exert less effort when working in a group compared to working alone. It is most likely to occur when: (1) Individual contributions are not identifiable or measurable, (2) Tasks are perceived as unimportant or meaningless, (3) Individual effort seems dispensable, (4) Group members feel their contribution won't be noticed, (5) There is low cohesion or team unity, (6) Individual accountability is low, (7) Group size is large, and (8) Members feel others aren't contributing their fair share."
        },
        {
            question: "What are the typical stages that sport teams work through to succeed as a group (forming, storming, norming, performing)?",
            answer: "(1) Forming - initial stage where team members come together, roles are unclear, and relationships are being established. (2) Storming - conflict stage where disagreements arise, roles are contested, and team members test boundaries. (3) Norming - cohesion develops, roles are accepted, norms are established, and team unity emerges. (4) Performing - team functions effectively, members work together efficiently, and high performance is achieved. Teams may cycle through these stages, especially when new members join or goals change."
        },
        {
            question: "What are specific teambuilding suggestions for establishing an effective team climate?",
            answer: "Suggestions include: (1) Develop team identity and shared goals, (2) Establish clear roles and responsibilities, (3) Create open communication channels, (4) Build trust through team activities and shared experiences, (5) Recognize and celebrate individual and team achievements, (6) Address conflicts directly and constructively, (7) Develop team norms and values, (8) Encourage mutual support and cooperation, (9) Provide opportunities for social interaction, (10) Foster a positive, inclusive environment, and (11) Set team goals and work toward them together."
        },
        {
            question: "What is Steiner's model of team dynamics, and how do motivation losses and coordination losses affect team performance?",
            answer: "Steiner's model states that Actual Productivity = Potential Productivity - (Motivation Losses + Coordination Losses). Potential productivity is what the team could achieve if all members performed at maximum. Motivation losses occur when team members don't give maximum effort (e.g., social loafing, lack of commitment). Coordination losses occur when team members don't work together effectively (e.g., poor communication, lack of synchronization). Both types of losses reduce actual team performance below potential."
        },
        {
            question: "What are the definitions of cohesion, including the difference between task and social cohesion?",
            answer: "Cohesion is the tendency for a group to stick together and remain united in pursuit of goals. Task cohesion refers to the degree to which team members work together to achieve common goals and objectives (focus on the task). Social cohesion refers to the degree to which team members like each other and enjoy each other's company (interpersonal relationships). Both are important, but task cohesion is more strongly related to team performance in sport."
        },
        {
            question: "How can a coach or leader effectively maximize individual performance within a team?",
            answer: "Strategies include: (1) Clarify individual roles and responsibilities, (2) Provide individual attention and feedback, (3) Recognize individual contributions, (4) Set individual goals within team context, (5) Match tasks to individual strengths, (6) Create opportunities for individual skill development, (7) Build individual confidence and self-efficacy, (8) Address individual needs and concerns, (9) Foster individual accountability, (10) Balance individual recognition with team goals, and (11) Help individuals see their value to the team."
        }
    ]
};

const chapterNames = {
    imagery: "Chapter 14: Imagery",
    goals: "Chapter 16: Goal Setting",
    leadership: "Chapter 10: Leadership",
    teams: "Chapter 9: Team Dynamics & Cohesion"
};

let currentChapter = 'imagery';
let currentMode = 'study'; // 'study' or 'test'

// Test questions with multiple choice options
const testQuestions = [
    // Chapter 14: Imagery
    {
        question: "What is mental imagery?",
        options: [
            "The cognitive process of creating or recreating experiences in the mind using all senses to visualize actions without physical execution",
            "A physical training technique that involves practicing movements repeatedly",
            "A form of meditation that focuses on breathing exercises",
            "A method of analyzing past performances through video review"
        ],
        correct: 0,
        chapter: "imagery"
    },
    {
        question: "What is the difference between internal and external imagery?",
        options: [
            "Internal imagery is from a first-person perspective, while external imagery is from a third-person perspective",
            "Internal imagery uses only visual senses, while external imagery uses all senses",
            "Internal imagery is for beginners, while external imagery is for advanced athletes",
            "Internal imagery focuses on outcomes, while external imagery focuses on processes"
        ],
        correct: 0,
        chapter: "imagery"
    },
    {
        question: "Why do athletes use imagery?",
        options: [
            "To improve performance, enhance motivation, build confidence, and practice skills mentally",
            "To replace physical practice entirely",
            "To analyze opponents' strategies",
            "To communicate with coaches during competition"
        ],
        correct: 0,
        chapter: "imagery"
    },
    {
        question: "What are the keys to effective imagery?",
        options: [
            "Vividness and controllability",
            "Speed and frequency",
            "Duration and intensity",
            "Location and timing"
        ],
        correct: 0,
        chapter: "imagery"
    },
    {
        question: "According to psychoneuromuscular theory, how does imagery work?",
        options: [
            "Imagery activates the same neural pathways as physical practice",
            "Imagery only works for visual learners",
            "Imagery requires physical movement to be effective",
            "Imagery is purely psychological with no physiological effects"
        ],
        correct: 0,
        chapter: "imagery"
    },
    // Chapter 16: Goal Setting
    {
        question: "What does SMARTS stand for in goal setting?",
        options: [
            "Specific, Measurable, Action-oriented, Realistic, Timely, Self-determined",
            "Simple, Meaningful, Achievable, Relevant, Time-bound, Structured",
            "Strategic, Motivating, Attainable, Rewarding, Trackable, Sustainable",
            "Systematic, Measurable, Ambitious, Realistic, Targeted, Specific"
        ],
        correct: 0,
        chapter: "goals"
    },
    {
        question: "What is the difference between outcome, performance, and process goals?",
        options: [
            "Outcome goals focus on winning, performance goals focus on personal achievement, process goals focus on specific actions",
            "Outcome goals are long-term, performance goals are medium-term, process goals are short-term",
            "Outcome goals are team-based, performance goals are individual, process goals are coach-directed",
            "There is no difference; they are interchangeable terms"
        ],
        correct: 0,
        chapter: "goals"
    },
    {
        question: "Which type of goal is most controllable and should be emphasized?",
        options: [
            "Process goals",
            "Outcome goals",
            "Performance goals",
            "Team goals"
        ],
        correct: 0,
        chapter: "goals"
    },
    {
        question: "Why does goal setting sometimes NOT work?",
        options: [
            "Setting unrealistic goals, lack of commitment, insufficient feedback, or poor goal specificity",
            "Goals are always effective when properly written",
            "Athletes don't understand the concept of goal setting",
            "Goal setting only works for individual sports, not team sports"
        ],
        correct: 0,
        chapter: "goals"
    },
    {
        question: "What is a common problem in goal setting?",
        options: [
            "Setting too many goals at once",
            "Setting goals that are too easy",
            "Writing goals down",
            "Sharing goals with teammates"
        ],
        correct: 0,
        chapter: "goals"
    },
    // Chapter 10: Leadership
    {
        question: "What are the four components of effective leadership in sport according to Weinberg and Gould?",
        options: [
            "Leader's qualities, Leadership styles, Situational factors, Follower's qualities",
            "Communication, Motivation, Strategy, Discipline",
            "Experience, Knowledge, Charisma, Authority",
            "Planning, Organizing, Leading, Controlling"
        ],
        correct: 0,
        chapter: "leadership"
    },
    {
        question: "What is the difference between relationship-oriented and task-oriented leaders?",
        options: [
            "Relationship-oriented leaders focus on building relationships and team cohesion, while task-oriented leaders focus on achieving goals and results",
            "Relationship-oriented leaders are more effective, while task-oriented leaders are less effective",
            "Relationship-oriented leaders work with individuals, while task-oriented leaders work with teams",
            "There is no significant difference between the two"
        ],
        correct: 0,
        chapter: "leadership"
    },
    {
        question: "What are the four components of Transformational Leadership?",
        options: [
            "Idealized influence, Inspirational motivation, Intellectual stimulation, Individualized consideration",
            "Vision, Communication, Empowerment, Recognition",
            "Planning, Execution, Evaluation, Improvement",
            "Authority, Discipline, Structure, Control"
        ],
        correct: 0,
        chapter: "leadership"
    },
    {
        question: "What is the trait approach to studying leadership?",
        options: [
            "It suggests leaders possess inherent personality characteristics",
            "It focuses on what leaders do rather than who they are",
            "It emphasizes the interaction between leader, followers, and situation",
            "It states that anyone can become a leader with proper training"
        ],
        correct: 0,
        chapter: "leadership"
    },
    {
        question: "In sport contexts, how do leaders differ from managers?",
        options: [
            "Leaders inspire and create vision, while managers organize and maintain systems",
            "Leaders are more important than managers",
            "Leaders work with athletes, while managers work with coaches",
            "There is no difference in sport contexts"
        ],
        correct: 0,
        chapter: "leadership"
    },
    {
        question: "What did John Wooden emphasize about success?",
        options: [
            "Success is about doing your best and maximizing potential, not just winning",
            "Success is measured only by wins and losses",
            "Success requires natural talent above all else",
            "Success is achieved through strict discipline and punishment"
        ],
        correct: 0,
        chapter: "leadership"
    },
    // Chapter 9: Team Dynamics
    {
        question: "What is social loafing?",
        options: [
            "The tendency for individuals to exert less effort when working in a group compared to working alone",
            "The tendency for teams to perform better than individuals",
            "A team-building exercise that involves physical activity",
            "The process of assigning roles within a team"
        ],
        correct: 0,
        chapter: "teams"
    },
    {
        question: "When is social loafing most likely to occur?",
        options: [
            "When individual contributions are not identifiable or when tasks are perceived as unimportant",
            "When teams are highly cohesive",
            "When individual accountability is high",
            "When team size is small"
        ],
        correct: 0,
        chapter: "teams"
    },
    {
        question: "What are the typical stages that sport teams work through?",
        options: [
            "Forming, Storming, Norming, Performing",
            "Planning, Training, Competing, Evaluating",
            "Introduction, Development, Mastery, Excellence",
            "Selection, Integration, Optimization, Domination"
        ],
        correct: 0,
        chapter: "teams"
    },
    {
        question: "According to Steiner's model, what affects team performance?",
        options: [
            "Actual Productivity = Potential Productivity - (Motivation Losses + Coordination Losses)",
            "Team performance is always equal to the sum of individual performances",
            "Team performance depends only on the best player",
            "Team performance is unrelated to individual contributions"
        ],
        correct: 0,
        chapter: "teams"
    },
    {
        question: "What is the difference between task cohesion and social cohesion?",
        options: [
            "Task cohesion focuses on working together to achieve goals, while social cohesion focuses on interpersonal relationships",
            "Task cohesion is more important than social cohesion",
            "Task cohesion is for competitive teams, while social cohesion is for recreational teams",
            "There is no meaningful difference"
        ],
        correct: 0,
        chapter: "teams"
    },
    {
        question: "Which type of cohesion is more strongly related to team performance in sport?",
        options: [
            "Task cohesion",
            "Social cohesion",
            "Both equally",
            "Neither type of cohesion affects performance"
        ],
        correct: 0,
        chapter: "teams"
    },
    {
        question: "What happens during the 'storming' stage of team development?",
        options: [
            "Conflict arises, disagreements occur, and team members test boundaries",
            "Team members come together and roles are established",
            "Team functions effectively and high performance is achieved",
            "Cohesion develops and team unity emerges"
        ],
        correct: 0,
        chapter: "teams"
    }
];

let currentTest = [];
let currentQuestionIndex = 0;
let userAnswers = [];
let testScore = 0;
let testSubmitted = false;

// Shuffle array function
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Toggle between study and test mode
function toggleMode() {
    console.log('toggleMode called, currentMode:', currentMode);
    try {
        if (currentMode === 'study') {
            console.log('Switching to test mode');
            currentMode = 'test';
            initTest();
            const modeToggle = document.getElementById('modeToggle');
            if (modeToggle) modeToggle.textContent = 'Study Mode';
            const chapterNav = document.getElementById('chapterNav');
            if (chapterNav) chapterNav.style.display = 'none';
            const studyStats = document.getElementById('studyStats');
            if (studyStats) studyStats.style.display = 'none';
            const testStats = document.getElementById('testStats');
            if (testStats) testStats.style.display = 'block';
        } else {
            console.log('Switching to study mode');
            currentMode = 'study';
            const firstButton = document.querySelector('[data-chapter="imagery"]');
            if (firstButton) showChapter('imagery', firstButton);
            const modeToggle = document.getElementById('modeToggle');
            if (modeToggle) modeToggle.textContent = 'Take Test';
            const chapterNav = document.getElementById('chapterNav');
            if (chapterNav) chapterNav.style.display = 'flex';
            const studyStats = document.getElementById('studyStats');
            if (studyStats) studyStats.style.display = 'block';
            const testStats = document.getElementById('testStats');
            if (testStats) testStats.style.display = 'none';
            const resultsContainer = document.getElementById('resultsContainer');
            if (resultsContainer) resultsContainer.style.display = 'none';
        }
    } catch (error) {
        console.error('Error in toggleMode:', error);
        alert('Error switching mode: ' + error.message);
    }
}

// Make function globally accessible
window.toggleMode = toggleMode;

// Initialize test
function initTest() {
    // Shuffle questions
    currentTest = shuffleArray(testQuestions);
    
    // Shuffle options for each question
    currentTest.forEach(question => {
        const options = question.options.map((opt, idx) => ({ text: opt, originalIdx: idx }));
        const shuffled = shuffleArray(options);
        const correctIndex = shuffled.findIndex(opt => opt.originalIdx === question.correct);
        question.shuffledOptions = shuffled.map(opt => opt.text);
        question.shuffledCorrect = correctIndex;
    });
    
    currentQuestionIndex = 0;
    userAnswers = [];
    testScore = 0;
    testSubmitted = false;
    
    updateTestDisplay();
}

// Update test display
function updateTestDisplay() {
    const content = document.getElementById('content');
    const currentQuestion = currentTest[currentQuestionIndex];
    
    document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
    document.getElementById('totalQuestions').textContent = currentTest.length;
    document.getElementById('currentScore').textContent = testScore;
    document.getElementById('maxScore').textContent = currentTest.length;
    
    content.innerHTML = `
        <div class="question-container">
            <div class="question-number">Question ${currentQuestionIndex + 1} of ${currentTest.length}</div>
            <div class="question-text">${currentQuestion.question}</div>
            <div class="answers">
                ${currentQuestion.shuffledOptions.map((option, idx) => `
                    <div class="answer-option ${userAnswers[currentQuestionIndex] === idx ? 'selected' : ''}" 
                         onclick="selectAnswer(${idx})">
                        <input type="radio" 
                               name="answer" 
                               value="${idx}" 
                               ${userAnswers[currentQuestionIndex] === idx ? 'checked' : ''}
                               onchange="selectAnswer(${idx})">
                        <label class="answer-label">${option}</label>
                    </div>
                `).join('')}
            </div>
            <button class="submit-btn" 
                    onclick="nextQuestion()" 
                    ${userAnswers[currentQuestionIndex] === undefined ? 'disabled' : ''}>
                ${currentQuestionIndex === currentTest.length - 1 ? 'Submit Test' : 'Next Question'}
            </button>
        </div>
    `;
}

// Select answer
function selectAnswer(index) {
    if (testSubmitted || currentMode !== 'test') return;
    
    userAnswers[currentQuestionIndex] = index;
    updateTestDisplay();
}

// Next question or submit
function nextQuestion() {
    if (userAnswers[currentQuestionIndex] === undefined || currentMode !== 'test') return;
    
    if (currentQuestionIndex < currentTest.length - 1) {
        currentQuestionIndex++;
        updateTestDisplay();
    } else {
        submitTest();
    }
}

// Submit test
function submitTest() {
    testSubmitted = true;
    testScore = 0;
    
    currentTest.forEach((question, idx) => {
        if (userAnswers[idx] === question.shuffledCorrect) {
            testScore++;
        }
    });
    
    const percentage = Math.round((testScore / currentTest.length) * 100);
    const resultsContainer = document.getElementById('resultsContainer');
    
    resultsContainer.style.display = 'block';
    resultsContainer.innerHTML = `
        <div class="results-container">
            <h2 style="color: #ffffff; margin-bottom: 20px;">Test Results</h2>
            <div class="score-display">${testScore} / ${currentTest.length}</div>
            <div class="score-text">${percentage}% Correct</div>
            <div style="margin-top: 30px;">
                <button class="retake-btn" onclick="retakeTest()">Retake Test</button>
            </div>
        </div>
    `;
    
    // Scroll to results
    resultsContainer.scrollIntoView({ behavior: 'smooth' });
}

// Retake test
function retakeTest() {
    initTest();
    document.getElementById('resultsContainer').style.display = 'none';
    document.getElementById('content').scrollIntoView({ behavior: 'smooth' });
}

function showChapter(chapter, button) {
    currentChapter = chapter;
    
    // Update active button
    document.querySelectorAll('.chapter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    if (button) {
        button.classList.add('active');
    }
    
    // Update stats
    document.getElementById('currentChapter').textContent = chapterNames[chapter];
    document.getElementById('totalCards').textContent = flashcards[chapter].length;
    
    // Render flashcards
    renderFlashcards(chapter);
}

function renderFlashcards(chapter) {
    const content = document.getElementById('content');
    const cards = flashcards[chapter];
    
    content.innerHTML = `
        <h2 class="chapter-title">${chapterNames[chapter]}</h2>
        <div class="flashcard-container">
            ${cards.map((card, index) => `
                <div class="flashcard" onclick="flipCard(this)">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div class="flashcard-number">${index + 1} / ${cards.length}</div>
                            <div class="flashcard-question">${card.question}</div>
                            <div class="flip-hint">Click to reveal answer</div>
                        </div>
                        <div class="flashcard-back">
                            <div class="flashcard-number">${index + 1} / ${cards.length}</div>
                            <div class="flashcard-answer">${formatAnswer(card.answer)}</div>
                            <div class="flip-hint">Click to see question</div>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function formatAnswer(answer) {
    // Convert numbered lists and bullet points to HTML
    return answer
        .replace(/\((\d+)\)/g, '<br><strong>$1.</strong>')
        .replace(/•/g, '•')
        .replace(/\n/g, '<br>');
}

function flipCard(card) {
    card.classList.toggle('flipped');
}

// Setup toggle button function
function setupToggleButton() {
    const modeToggleBtn = document.getElementById('modeToggle');
    if (modeToggleBtn) {
        console.log('Setting up toggle button');
        // Remove any existing listeners by cloning the node
        const newBtn = modeToggleBtn.cloneNode(true);
        modeToggleBtn.parentNode.replaceChild(newBtn, modeToggleBtn);
        
        // Add event listener
        newBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Button clicked');
            toggleMode();
        });
        
        // Also make it accessible via onclick for compatibility
        newBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            toggleMode();
            return false;
        };
    } else {
        console.error('Mode toggle button not found');
    }
}

// Initialize with first chapter
window.onload = function() {
    const firstButton = document.querySelector('[data-chapter="imagery"]');
    if (firstButton) {
        showChapter('imagery', firstButton);
    }
    
    // Set up toggle button
    setupToggleButton();
};

// Also set up when DOM is ready (in case window.onload fires too late)
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        setupToggleButton();
    });
} else {
    // DOM already loaded
    setupToggleButton();
}

